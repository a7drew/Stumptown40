<!DOCTYPE html>
<html>
<head>
    <title>Sample Public Page</title>
    <style type="text/css">
        body {
            font-family: Courier;
            background: #000;
            color: #008800;
        }
    </style>
</head>
<body>
       
    <h1>Public Page</h1>

    <ul id="discussion">
    </ul>

    <script src="http://stumptown40.azurewebsites.net/Scripts/jquery-1.8.3.min.js"></script>
    <script src="http://stumptown40.azurewebsites.net/Scripts/jquery.signalR-1.0.0.js"></script>
    <script src="http://stumptown40.azurewebsites.net/signalr/hubs"></script>
    <script type="text/javascript">

        var gRacerCache = null;

        $(function () {

            // Declare a proxy to reference the hub. 
            $.support.cors = true;
            $.connection.hub.url = 'http://stumptown40.azurewebsites.net/signalr';

            var hub = $.connection.navigationHub;

            // Create a function that the hub can call to broadcast messages.
            hub.client.onNavigate = function (viewName, jsonData) {

                var encodedName = $('<div />').text(viewName).html();
                var encodedMsg = $('<div />').text(jsonData).html();

                $('#discussion').append('<li><strong>' + encodedName + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
            };

            $.getJSON('http://stumptown40.azurewebsites.net/api/cars?callback=?', function (e) {
                gRacerCache = e;
                $('#discussion').append('<li>' + gRacerCache.length + ' racers received.</li>');

                var car = gRacerCache[0];
                var html = '<ul style="margin-bottom:10px;">';
                html += '<li>CarId: ' + car.CarId + '</li>';
                html += '<li>CarNumber: ' + car.CarNumber + '</li>';
                html += '<li>DivisionId: ' + car.DivisionId + '</li>';
                html += '<li>Name: ' + car.Name + '</li>';
                html += '<li>Organization: ' + car.Organization + '</li>';
                html += '<li>PositionId: ' + car.PositionId + '</li>';
                html += '</ul>';

                $('#discussion').append('<li>Here&apos;s the first racer:' + html + '</li>');
            });

            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#discussion').append('<li>Ready to receive messages from server.</li>');
            });
        });

    </script>

</body>
</html>
